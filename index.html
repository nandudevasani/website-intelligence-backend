<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Website Intelligence Bulk Scanner</title>
<style>
body { font-family: sans-serif; max-width: 1100px; margin: 20px auto; }
textarea { width: 100%; height: 120px; padding: 6px; font-size: 13px; }
button { padding: 6px 12px; margin: 6px 0; cursor: pointer; font-size: 13px; }
table { width: 100%; border-collapse: collapse; margin-top: 12px; font-size: 12px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; vertical-align: top; }
th { background: #f0f0f0; }
</style>
</head>
<body>

<h2>Website Intelligence Bulk Scanner</h2>

<p>Enter domains (one per line):</p>
<textarea id="domains" placeholder="example.com&#10;google.com"></textarea>
<br>
<button onclick="scanBulk()">Scan Websites</button>
<button onclick="exportCSV()">Export CSV</button>

<table id="resultsTable">
<thead>
<tr>
<th>Domain</th>
<th>Status</th>
<th>Status Code</th>
<th>Reason</th>
<th>Business Name</th>
<th>Street</th>
<th>City</th>
<th>State</th>
<th>ZIP</th>
<th>Phone</th>
<th>Email</th>
<th>Facebook</th>
<th>GMB</th>
<th>LinkedIn</th>
<th>Instagram</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
const backendURL = "https://website-intelligence-backend-2.onrender.com/bulk-analyze";

async function scanBulk() {
  const domains = document.getElementById("domains").value
    .split("\n").map(d => d.trim()).filter(Boolean);

  if (domains.length === 0) return alert("Enter at least one domain");

  const tbody = document.querySelector("#resultsTable tbody");
  tbody.innerHTML = "<tr><td colspan='15'>Scanning...</td></tr>";

  try {
    const res = await fetch(backendURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ domains })
    });
    const data = await res.json();

    tbody.innerHTML = "";
    data.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.domain}</td>
        <td>${r.status}</td>
        <td>${r.statusCode}</td>
        <td>${r.reason || ""}</td>
        <td>${r.name || ""}</td>
        <td>${r.street || ""}</td>
        <td>${r.city || ""}</td>
        <td>${r.state || ""}</td>
        <td>${r.zip || ""}</td>
        <td>${r.phone || ""}</td>
        <td>${r.email || ""}</td>
        <td>${r.social.facebook ? "✓" : ""}</td>
        <td>${r.social.gmb ? "✓" : ""}</td>
        <td>${r.social.linkedin ? "✓" : ""}</td>
        <td>${r.social.instagram ? "✓" : ""}</td>
      `;
      tbody.appendChild(tr);
    });

  } catch (err) {
    tbody.innerHTML = "<tr><td colspan='15'>Error fetching data</td></tr>";
    console.error(err);
  }
}

function exportCSV() {
  const rows = [["Domain","Status","Status Code","Reason","Business Name","Street","City","State","ZIP","Phone","Email","Facebook","GMB","LinkedIn","Instagram"]];
  document.querySelectorAll("#resultsTable tbody tr").forEach(tr => {
    const cols = Array.from(tr.children).map(td => td.textContent);
    rows.push(cols);
  });
  const csv = rows.map(r => r.map(c => `"${c}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type: "text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "website_scan_results.csv";
  a.click();
}
</script>

</body>
</html>
