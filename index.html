<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bulk Website Intelligence Scanner</title>
<style>
body { font-family: Arial; padding:30px; background:#f4f6f8; }
textarea { width: 100%; height: 150px; padding:10px; }
button { padding:10px 20px; margin-top:10px; cursor:pointer; }
#results { margin-top:20px; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ccc; padding: 6px; text-align:center; font-size:12px; }
th { background:#2563eb; color:#fff; }
tr.active { background:#dcfce7; }
tr.inactive { background:#fee2e2; }
tr.coming { background:#fef9c3; }
tr.unverified { background:#f1f5f9; }
</style>
</head>
<body>

<h2>Bulk Website Intelligence Scanner</h2>

<p>Enter one domain per line:</p>
<textarea id="domains" placeholder="example.com&#10;google.com"></textarea>
<br>
<button onclick="scanBulk()">Scan Websites</button>
<button onclick="exportCSV()">Export CSV</button>

<div id="results"></div>

<script>
let latestResults = [];

async function scanBulk() {
  const input = document.getElementById("domains").value;
  if (!input.trim()) { alert("Please enter domains."); return; }

  const domains = input.split("\n").map(d => d.trim()).filter(d => d);
  const resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "Scanning... Please wait...";

  try {
    const response = await fetch("https://website-intelligence-backend-2.onrender.com/bulk-analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ domains })
    });

    if (!response.ok) { resultsDiv.innerHTML = "Server error: " + response.status; return; }

    const data = await response.json();
    latestResults = data;

    let html = `<table>
    <tr>
      <th>Domain</th><th>Status</th><th>Reason</th>
      <th>Phone</th><th>Email</th>
      <th>Facebook</th><th>Instagram</th><th>LinkedIn</th>
      <th>Domain Age</th>
    </tr>`;

    data.forEach(item => {
      let rowClass = item.status.toLowerCase();
      html += `<tr class="${rowClass}">
        <td>${item.domain}</td>
        <td>${item.status}</td>
        <td>${item.reason || ""}</td>
        <td>${item.phone || ""}</td>
        <td>${item.email || ""}</td>
        <td>${item.social.facebook ? "✔" : ""}</td>
        <td>${item.social.instagram ? "✔" : ""}</td>
        <td>${item.social.linkedin ? "✔" : ""}</td>
        <td>${item.domainAge || ""}</td>
      </tr>`;
    });

    html += "</table>";
    resultsDiv.innerHTML = html;

  } catch (error) {
    resultsDiv.innerHTML = "Error: " + error.message;
  }
}

function exportCSV() {
  if (!latestResults.length) { alert("No results to export."); return; }

  const header = "Domain,Status,Reason,Phone,Email,Facebook,Instagram,LinkedIn,Domain Age";
  const rows = latestResults.map(r => [
    r.domain,
    r.status,
    r.reason || "",
    r.phone || "",
    r.email || "",
    r.social.facebook ? "Yes" : "",
    r.social.instagram ? "Yes" : "",
    r.social.linkedin ? "Yes" : "",
    r.domainAge || ""
  ].join(","));

  const csv = [header, ...rows].join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "bulk_scan_results.csv";
  a.click();
  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
