<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Website Intelligence Scanner</title>
<style>
body { font-family: Arial; max-width: 1000px; margin: auto; padding: 20px; }
textarea { width: 100%; height: 100px; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 5px; text-align: left; font-size: 12px; }
th { background: #f0f0f0; }
button { padding: 6px 12px; margin-top: 10px; cursor: pointer; }
</style>
</head>
<body>

<h2>Website Intelligence Scanner</h2>

<textarea id="domains" placeholder="Enter domains, one per line"></textarea>
<br>
<button onclick="scanBulk()">Scan Websites</button>
<button onclick="exportCSV()">Export CSV</button>

<table id="results">
<thead>
<tr>
<th>Domain</th>
<th>Status</th>
<th>Reason</th>
<th>Business Name</th>
<th>Street</th>
<th>City</th>
<th>State</th>
<th>Zip</th>
<th>Phone</th>
<th>Email</th>
<th>Facebook</th>
<th>GMB</th>
<th>LinkedIn</th>
<th>Instagram</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
async function scanBulk() {
  const domains = document.getElementById("domains").value.split("\n").map(d => d.trim()).filter(d => d);
  if(domains.length === 0) return alert("Enter at least one domain");

  const tbody = document.querySelector("#results tbody");
  tbody.innerHTML = "<tr><td colspan='14'>Scanning...</td></tr>";

  try {
    const res = await fetch("https://website-intelligence-backend-1.onrender.com/bulk-analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ domains })
    });
    const data = await res.json();
    tbody.innerHTML = "";
    data.forEach(d => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${d.domain}</td>
        <td>${d.status}</td>
        <td>${d.reason}</td>
        <td>${d.name}</td>
        <td>${d.street}</td>
        <td>${d.city}</td>
        <td>${d.state}</td>
        <td>${d.zip}</td>
        <td>${d.phone}</td>
        <td>${d.email}</td>
        <td>${d.social.facebook}</td>
        <td>${d.social.gmb}</td>
        <td>${d.social.linkedin}</td>
        <td>${d.social.instagram}</td>
      `;
      tbody.appendChild(row);
    });
  } catch(e) {
    tbody.innerHTML = "<tr><td colspan='14'>Error fetching data</td></tr>";
  }
}

function exportCSV() {
  const rows = Array.from(document.querySelectorAll("#results tr"));
  const csv = rows.map(r => Array.from(r.cells).map(c => `"${c.innerText.replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], { type: "text/csv" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "results.csv";
  a.click();
  URL.revokeObjectURL(a.href);
}
</script>

</body>
</html>
